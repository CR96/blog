---
import type { Props as PortableTextProps } from 'astro-portabletext/types';
import { sanityClient } from 'sanity:client';
import imageUrlBuilder from '@sanity/image-url';
import CaptionedElement from './CaptionedElement.astro';
import type { Post, SanityImageAsset } from '../groq';
import { Picture } from 'astro:assets';

type Props = PortableTextProps<Extract<Post['content'][number], { '_type': 'image' }>>;

const { asset, alt = "", caption } = Astro.props.node;

const builder = imageUrlBuilder(sanityClient);
const src = builder.image(asset).url();
---

<CaptionedElement caption={ caption }>
    <Picture
        src={ src }
        alt={ alt }
        formats={ [ 'avif', 'jpeg' ] }
        fallbackFormat='jpeg'
        widths={ [ 760, 1520 ] }
        sizes={ `
            (max-width: 760px) 760px,
            1520px
        ` }
        inferSize
    />
</CaptionedElement>
<style>
    img {
        width: 100%;
    }
</style>