---
import CaptionedElement from './CaptionedElement.astro';
import type { DereferencedContentBlock } from '../../studio/sanity-queries';
import { Picture } from 'astro:assets';

type Props = DereferencedContentBlock<'image'>;

const { asset, alt = "", caption } = Astro.props.node;

if (!asset || !asset.url || !asset.metadata?.dimensions) { return; }

const { width = 0, height = 0 } = asset.metadata.dimensions;
---

<CaptionedElement caption={ caption }>
    <Picture
        src={ asset.url }
        alt={ alt }
        width={ width }
        height={ height }
        widths={ [ 760, 1520 ] }
        sizes={ `
            (max-width: 760px) 760px,
            1520px
        ` }
    />
</CaptionedElement>
<style>
    img {
        width: 100%;
    }
</style>