---
import { sanityClient } from 'sanity:client';
import imageUrlBuilder from '@sanity/image-url';
import CaptionedElement from './CaptionedElement.astro';
import type { DereferencedContentBlock } from '../../studio/sanity-queries';
import { Picture } from 'astro:assets';

type Props = DereferencedContentBlock<'image'>;

const { asset, alt = "", caption } = Astro.props.node;

if (!asset) { return; }

const builder = imageUrlBuilder(sanityClient);
const src = builder.image(asset).url();
---

<CaptionedElement caption={ caption }>
    <Picture
        src={ src }
        alt={ alt }
        formats={ [ 'avif', 'jpeg' ] }
        fallbackFormat='jpeg'
        widths={ [ 760, 1520 ] }
        sizes={ `
            (max-width: 760px) 760px,
            1520px
        ` }
        inferSize
    />
</CaptionedElement>
<style>
    img {
        width: 100%;
    }
</style>