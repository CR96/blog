---
import type { Props as PortableTextProps } from 'astro-portabletext/types';
import CaptionedElement from "./CaptionedElement.astro";
import type { Post, MuxVideoAsset } from '../groq';
import { resolveSanityRef } from '../util';

type Props = PortableTextProps<Extract<Post['content'][number], { '_type': 'video' }>>;

const { video, caption } = Astro.props.node;
const { asset: assetRef } = video;

if (!assetRef) { return; }
const asset = await resolveSanityRef<MuxVideoAsset>(assetRef);
---

<CaptionedElement caption={ caption }>
    <mux-player playback-id={ asset.playbackId } />
</CaptionedElement>
<script>
    import '@mux/mux-player';
</script>
<style>
    mux-player {
        aspect-ratio: 16 / 9;
        --media-accent-color: var(--blue-700);
        border-radius: 0.5rem;
        overflow: hidden;
    }
</style>